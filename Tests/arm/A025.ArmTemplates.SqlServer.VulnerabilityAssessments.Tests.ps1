
Describe "Sql Server Vulnerability Assessments Tests" -Tag "Acceptance" {

  BeforeAll {
    # common variables
    $ResourceGroupName = "dfc-test-template-rg"
    $TemplateFile = "$PSScriptRoot\..\..\ArmTemplates\SqlServer\sql-vulnerability-assessments.json"
  }

  Context "When Vulnerability Assssements are deployed" {

    BeforeAll {
      $TemplateParameters = @{
        sqlServerName = "dfc-foo-sql"
        notificationEmails  = "careersdevops@education.gov.uk"
      }
  
      $TestTemplateParams = @{
        ResourceGroupName       = $ResourceGroupName
        TemplateFile            = $TemplateFile
        TemplateParameterObject = $TemplateParameters
      }
 
    }
    It "Should be deployed successfully" {
      $output = Test-AzResourceGroupDeployment @TestTemplateParams
      $output | Should -Be $null
    }
  }
}